<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MESA - Open Idea Dropbox</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Grotesk:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    .orbitron { font-family: 'Orbitron', sans-serif; }
    .space-grotesk { font-family: 'Space Grotesk', sans-serif; }
  </style>
</head>
<body class="bg-black min-h-screen text-white">
  <div id="app"></div>

  <script>
    // ==========================================
    // SUPABASE CONFIGURATION
    // ==========================================
    const SUPABASE_URL = 'https://xkpwcchgzumymmugsrps.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhrcHdjY2hnenVteW1tdWdzcnBzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NzcwMzEsImV4cCI6MjA3NzU1MzAzMX0.gqVo1YjTvd13rnoiYdcfLKZNHR8XOUoI8pnCDrbRUQA';

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ==========================================
    // APP STATE
    // ==========================================
    let ideas = [];
    let loading = true;
    let currentPage = 'submit'; // 'submit' or 'explore'
    let searchQuery = '';

    // ==========================================
    // SUPABASE FUNCTIONS
    // ==========================================
    async function loadIdeas() {
      loading = true;
      render();
      
      try {
        const { data, error } = await supabase
          .from('ideas')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) throw error;
        ideas = data || [];
      } catch (error) {
        console.error('Error loading ideas:', error);
        showMessage('Error loading ideas: ' + error.message);
      }
      
      loading = false;
      render();
    }

    async function uploadFile(file, bucket = 'idea-files') {
      try {
        const fileExt = file.name.split('.').pop();
        const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
        const filePath = `${fileName}`;

        const { data, error } = await supabase.storage
          .from(bucket)
          .upload(filePath, file);

        if (error) throw error;

        const { data: urlData } = supabase.storage
          .from(bucket)
          .getPublicUrl(filePath);

        return {
          name: file.name,
          path: filePath,
          url: urlData.publicUrl,
          size: file.size
        };
      } catch (error) {
        console.error('Error uploading file:', error);
        throw error;
      }
    }

    async function submitIdea(event) {
      event.preventDefault();
      
      const formData = new FormData(event.target);
      const title = formData.get('title');
      const description = formData.get('description');
      const developer = formData.get('developer');
      const contact = formData.get('contact');
      const linksText = formData.get('links');
      const imageFiles = formData.getAll('images');
      const documentFiles = formData.getAll('documents');

      if (!title.trim()) {
        showMessage('Please add a title for your idea');
        return;
      }

      showMessage('Uploading... Please wait', 'info');

      try {
        const images = [];
        for (const file of imageFiles) {
          if (file.size > 0) {
            const uploaded = await uploadFile(file, 'idea-images');
            images.push(uploaded);
          }
        }

        const documents = [];
        for (const file of documentFiles) {
          if (file.size > 0) {
            const uploaded = await uploadFile(file, 'idea-documents');
            documents.push(uploaded);
          }
        }

        const videoFiles = formData.getAll('videos');
        const videos = [];
        for (const file of videoFiles) {
          if (file.size > 0) {
            const uploaded = await uploadFile(file, 'idea-videos');
            videos.push(uploaded);
          }
        }

        const links = linksText ? linksText.split('\n').filter(link => link.trim()) : [];

        const { data, error } = await supabase
          .from('ideas')
          .insert([
            {
              title: title,
              description: description || null,
              developer: developer || null,
              contact: contact || null,
              links: links,
              images: images,
              documents: documents,
              videos: videos
            }
          ])
          .select();

        if (error) throw error;

        showMessage('Idea submitted successfully!', 'success');
        event.target.reset();
        document.getElementById('imagePreview').innerHTML = '';
        document.getElementById('docPreview').innerHTML = '';
        document.getElementById('videoPreview').innerHTML = '';
        await loadIdeas();
      } catch (error) {
        console.error('Error submitting idea:', error);
        showMessage('Error: ' + error.message);
      }
    }

    async function deleteIdea(id, images = [], documents = [], videos = []) {
      if (!confirm('Are you sure you want to delete this idea?')) return;

      try {
        for (const img of images) {
          await supabase.storage.from('idea-images').remove([img.path]);
        }
        for (const doc of documents) {
          await supabase.storage.from('idea-documents').remove([doc.path]);
        }
        for (const vid of videos) {
          await supabase.storage.from('idea-videos').remove([vid.path]);
        }

        const { error } = await supabase
          .from('ideas')
          .delete()
          .eq('id', id);

        if (error) throw error;

        showMessage('Idea deleted successfully!', 'success');
        await loadIdeas();
      } catch (error) {
        console.error('Error deleting idea:', error);
        showMessage('Error deleting idea: ' + error.message);
      }
    }

    // ==========================================
    // UTILITY FUNCTIONS
    // ==========================================
    function showMessage(message, type = 'error') {
      const messageDiv = document.createElement('div');
      const bgColor = type === 'success' ? 'bg-green-600' : type === 'info' ? 'bg-blue-600' : 'bg-red-600';
      messageDiv.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-pulse`;
      messageDiv.textContent = message;
      document.body.appendChild(messageDiv);
      setTimeout(() => messageDiv.remove(), 3000);
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    function formatDate(dateString) {
      return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function handleFilePreview(input, previewId) {
      const previewDiv = document.getElementById(previewId);
      const files = Array.from(input.files);
      
      if (files.length > 0) {
        previewDiv.innerHTML = `
          <div class="mt-2 space-y-2">
            ${files.map((file) => `
              <div class="flex items-center justify-between bg-gray-900 p-2 rounded border border-gray-800">
                <span class="text-sm truncate flex-1 text-gray-300">${escapeHtml(file.name)}</span>
                <span class="text-xs text-gray-500 ml-2">${formatFileSize(file.size)}</span>
              </div>
            `).join('')}
          </div>
        `;
      } else {
        previewDiv.innerHTML = '';
      }
    }

    function switchPage(page) {
      currentPage = page;
      searchQuery = '';
      render();
    }

    function handleSearch(event) {
      searchQuery = event.target.value.toLowerCase();
      render();
    }

    function getFilteredIdeas() {
      if (!searchQuery) return ideas;
      return ideas.filter(idea => 
        idea.title.toLowerCase().includes(searchQuery)
      );
    }

    // ==========================================
    // RENDER FUNCTIONS
    // ==========================================
    function renderNavigation() {
      return `
        <nav class="bg-gray-900 border-b border-gray-800">
          <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
              <div class="flex items-center gap-3">
                <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
                <h1 class="text-2xl font-bold orbitron text-purple-400">MESA</h1>
              </div>
              <div class="flex gap-4">
                <button onclick="switchPage('submit')" class="px-4 py-2 rounded-lg space-grotesk font-semibold transition-all ${currentPage === 'submit' ? 'bg-purple-600 text-white' : 'text-gray-400 hover:text-white hover:bg-gray-800'}">
                  Submit Idea
                </button>
                <button onclick="switchPage('explore')" class="px-4 py-2 rounded-lg space-grotesk font-semibold transition-all ${currentPage === 'explore' ? 'bg-purple-600 text-white' : 'text-gray-400 hover:text-white hover:bg-gray-800'}">
                  Explore Ideas
                </button>
              </div>
            </div>
          </div>
        </nav>
      `;
    }

    function renderSubmitPage() {
      return `
        <div class="py-12 px-4 max-w-6xl mx-auto">
          <!-- Hero Section -->
          <div class="text-center mb-16">
            <h1 class="text-6xl md:text-7xl font-black orbitron mb-6 bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 bg-clip-text text-transparent">
              WELCOME TO MESA
            </h1>
            <p class="text-2xl md:text-3xl space-grotesk font-light text-gray-300 mb-4">
              THE PISTON POWER
            </p>
            <p class="text-lg space-grotesk text-gray-400 max-w-3xl mx-auto leading-relaxed">
              Share your mind with projects you've made - PPTs, videos, and anything you've got!
            </p>
            <p class="text-xl space-grotesk font-semibold text-purple-400 mt-6">
              If the idea contains piston power, MESA will find you.
            </p>
          </div>

          <!-- Submit Form -->
          <div class="bg-gray-900 rounded-2xl shadow-2xl p-8 mb-8 border border-gray-800">
            <h3 class="text-3xl font-bold mb-8 text-purple-400 flex items-center gap-3 orbitron">
              <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
              Drop Your Idea
            </h3>
            
            <form id="ideaForm" onsubmit="submitIdea(event)" class="space-y-6 space-grotesk">
              <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Title *</label>
                <input type="text" name="title" required class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white" placeholder="Give your idea a catchy title...">
              </div>

              <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Description</label>
                <textarea name="description" rows="4" class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white" placeholder="Describe your idea in detail..."></textarea>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-semibold text-gray-300 mb-2">Developer Name</label>
                  <input type="text" name="developer" class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white" placeholder="Your name or team name">
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-300 mb-2">Contact Details</label>
                  <input type="text" name="contact" class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white" placeholder="Email or phone number">
                </div>
              </div>

              <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Links (one per line)</label>
                <textarea name="links" rows="3" class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white" placeholder="https://example.com
https://another-link.com"></textarea>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-sm font-semibold text-gray-300 mb-2">Images</label>
                  <input type="file" name="images" accept="image/*" multiple class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white hover:file:bg-purple-700" onchange="handleFilePreview(this, 'imagePreview')">
                  <div id="imagePreview"></div>
                </div>

                <div>
                  <label class="block text-sm font-semibold text-gray-300 mb-2">Videos</label>
                  <input type="file" name="videos" accept="video/*" multiple class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white hover:file:bg-purple-700" onchange="handleFilePreview(this, 'videoPreview')">
                  <div id="videoPreview"></div>
                </div>
              </div>

              <div>
                <label class="block text-sm font-semibold text-gray-300 mb-2">Documents (PDF, PPT, etc.)</label>
                <input type="file" name="documents" accept=".pdf,.ppt,.pptx,.doc,.docx" multiple class="w-full px-4 py-3 bg-black border border-gray-700 rounded-lg text-gray-300 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white hover:file:bg-purple-700" onchange="handleFilePreview(this, 'docPreview')">
                <div id="docPreview"></div>
              </div>

              <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-lg font-bold text-lg hover:from-purple-700 hover:to-pink-700 transition-all transform hover:scale-105">
                ðŸš€ Submit Idea
              </button>
            </form>
          </div>
        </div>
      `;
    }

    function renderExplorePage() {
      const filteredIdeas = getFilteredIdeas();
      
      return `
        <div class="py-12 px-4 max-w-7xl mx-auto">
          <!-- Header -->
          <div class="mb-12">
            <h1 class="text-5xl md:text-6xl font-black orbitron mb-6 text-center bg-gradient-to-r from-purple-400 via-pink-500 to-red-500 bg-clip-text text-transparent">
              EXPLORE IDEAS
            </h1>
            
            <!-- Search Bar -->
            <div class="max-w-2xl mx-auto mb-8">
              <div class="relative">
                <input 
                  type="text" 
                  placeholder="Search ideas by title..." 
                  oninput="handleSearch(event)"
                  value="${escapeHtml(searchQuery)}"
                  class="w-full px-6 py-4 pl-14 bg-gray-900 border-2 border-gray-700 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-white text-lg space-grotesk"
                >
                <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
              </div>
            </div>

            <p class="text-center text-gray-400 space-grotesk">
              ${filteredIdeas.length} idea${filteredIdeas.length !== 1 ? 's' : ''} found
            </p>
          </div>

          <!-- Ideas Grid -->
          <div class="space-y-8">
            ${filteredIdeas.length === 0 ? `
              <div class="bg-gray-900 rounded-2xl shadow-2xl p-16 text-center border border-gray-800">
                <svg class="w-20 h-20 text-gray-700 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
                <p class="text-gray-400 text-xl space-grotesk">${searchQuery ? 'No ideas match your search' : 'No ideas yet. Be the first to share!'}</p>
              </div>
            ` : filteredIdeas.map(idea => `
              <div class="bg-gray-900 rounded-2xl shadow-2xl p-8 hover:shadow-purple-900/20 transition-all border border-gray-800 hover:border-purple-600">
                <div class="flex justify-between items-start mb-6">
                  <div class="flex-1">
                    <h4 class="text-3xl font-bold text-purple-400 mb-3 orbitron">${escapeHtml(idea.title)}</h4>
                    <div class="flex flex-wrap gap-4 text-sm text-gray-400 space-grotesk">
                      <div class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        ${formatDate(idea.created_at)}
                      </div>
                      ${idea.developer ? `
                        <div class="flex items-center gap-2">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                          </svg>
                          ${escapeHtml(idea.developer)}
                        </div>
                      ` : ''}
                      ${idea.contact ? `
                        <div class="flex items-center gap-2">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                          </svg>
                          ${escapeHtml(idea.contact)}
                        </div>
                      ` : ''}
                    </div>
                  </div>
                  <button onclick='deleteIdea("${idea.id}", ${JSON.stringify(idea.images || [])}, ${JSON.stringify(idea.documents || [])}, ${JSON.stringify(idea.videos || [])})' class="text-red-500 hover:text-red-400 p-2 hover:bg-red-500/10 rounded-lg transition-all" title="Delete idea">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </button>
                </div>

                ${idea.description ? `<p class="text-gray-300 mb-6 whitespace-pre-wrap space-grotesk leading-relaxed">${escapeHtml(idea.description)}</p>` : ''}

                ${idea.images && idea.images.length > 0 ? `
                  <div class="mb-6">
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                      </svg>
                      <span class="font-semibold text-purple-400 space-grotesk">Images</span>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                      ${idea.images.map(img => `
                        <a href="${img.url}" target="_blank" class="relative group">
                          <img src="${img.url}" alt="${escapeHtml(img.name)}" class="w-full h-32 object-cover rounded-lg border-2 border-gray-800 group-hover:border-purple-500 transition-all" loading="lazy">
                          <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-opacity rounded-lg flex items-center justify-center">
                            <span class="opacity-0 group-hover:opacity-100 text-white text-sm font-semibold">View</span>
                          </div>
                        </a>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}

                ${idea.videos && idea.videos.length > 0 ? `
                  <div class="mb-6">
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                      </svg>
                      <span class="font-semibold text-purple-400 space-grotesk">Videos</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      ${idea.videos.map(vid => `
                        <div class="bg-black rounded-lg p-3 border border-gray-800">
                          <video controls class="w-full rounded-lg border border-gray-700" preload="metadata">
                            <source src="${vid.url}" type="video/mp4">
                            <source src="${vid.url}" type="video/webm">
                            <source src="${vid.url}" type="video/ogg">
                            Your browser does not support the video tag.
                          </video>
                          <p class="text-xs text-gray-400 mt-2 truncate space-grotesk">${escapeHtml(vid.name)}</p>
                          <p class="text-xs text-gray-600 space-grotesk">${formatFileSize(vid.size)}</p>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}

                ${idea.documents && idea.documents.length > 0 ? `
                  <div class="mb-6">
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                      </svg>
                      <span class="font-semibold text-purple-400 space-grotesk">Documents</span>
                    </div>
                    <div class="space-y-2">
                      ${idea.documents.map(doc => `
                        <a href="${doc.url}" target="_blank" download="${escapeHtml(doc.name)}" class="flex items-center justify-between bg-black p-4 rounded-lg hover:bg-gray-800 transition-all border border-gray-800 hover:border-purple-500">
                          <div class="flex items-center gap-3">
                            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span class="text-sm font-medium text-gray-300 space-grotesk">${escapeHtml(doc.name)}</span>
                          </div>
                          <span class="text-xs text-gray-500 space-grotesk">${formatFileSize(doc.size)}</span>
                        </a>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}

                ${idea.links && idea.links.length > 0 ? `
                  <div>
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                      </svg>
                      <span class="font-semibold text-purple-400 space-grotesk">Links</span>
                    </div>
                    <div class="space-y-2">
                      ${idea.links.map(link => `
                        <a href="${escapeHtml(link)}" target="_blank" rel="noopener noreferrer" class="block text-purple-400 hover:text-purple-300 underline text-sm break-all space-grotesk">
                          ${escapeHtml(link)}
                        </a>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function render() {
      const app = document.getElementById('app');
      
      if (loading) {
        app.innerHTML = `
          <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
              <svg class="animate-spin h-16 w-16 text-purple-500 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <div class="text-2xl text-gray-400 orbitron">Loading ideas...</div>
            </div>
          </div>
        `;
        return;
      }

      app.innerHTML = `
        ${renderNavigation()}
        ${currentPage === 'submit' ? renderSubmitPage() : renderExplorePage()}
      `;
    }

    // ==========================================
    // INITIALIZATION
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
      loadIdeas();
    });
  </script>
</body>
</html>